defaults:
  - override hydra/sweeper: optuna
  - override hydra/sweeper/sampler: tpe
  - override hydra/launcher: joblib # For multiprocessing with n_jobs > 1

hydra:
  launcher:
    _target_: hydra_plugins.hydra_joblib_launcher.joblib_launcher.JoblibLauncher
#    _target_: hydra_plugins.hydra_async_parallel_launcher.async_parallel_launcher.AsyncParallelLauncher
#    n_jobs: 1
#    backend: null
#    prefer: processes
#    require: null
#    verbose: 0
#    timeout: null
#    pre_dispatch: 2*n_jobs
#    batch_size: auto
#    temp_folder: null
#    max_nbytes: null
#    mmap_mode: r
  sweeper:
    sampler:
      _target_: optuna.samplers.TPESampler
      seed: 123
      consider_prior: true
      prior_weight: 1.0
      consider_magic_clip: true
      consider_endpoints: false
      n_startup_trials: 10
      n_ei_candidates: 24
      multivariate: false
      warn_independent_sampling: true
#    _target_: hydra_plugins.hydra_optuna_sweeper.optuna_sweeper.OptunaSweeper
    _target_: hydra_plugins.hydra_custom_optuna_sweeper.custom_optuna_sweeper.CustomOptunaSweeper
    direction: maximize
    study_name: simple_mnist
    storage: sqlite:///simple_mnist.db
#    storage: null
#    storage: mysql://hyperopt_user@localhost/ideas_hrl_hyperopt_database
    max_trials: 200
    n_jobs: 6
    max_duration_minutes: 15
    min_trials_per_param: 3
    max_trials_per_param: 5
#    max_repeats_prune: 1

    search_space:
      model.fc1_units:
        type: int
        low: 8
        high: 256
        step: 8
      model.fc2_units:
        type: int
        low: 8
        high: 256
        step: 8
      model.conv1.n_kernels:
        type: int
        low: 2
        high: 12
        step: 1
      model.conv2.n_kernels:
        type: int
        low: 2
        high: 12
        step: 1

model:
  conv1:
    kernel_size: 3
    n_kernels: 7
  conv2:
    kernel_size: 3
    n_kernels: 15
  fc1_units: 64
  fc2_units: 64

optimizer:
  lr: 0.001
  momentum: 0.9

train:
  batch_size: 4
  epoch: 7

test:
  batch_size: 4

#hyperopt:
#  parallel_runs: 1

#mlflow:
#  runname: "testrun"